# 调优参数、结果



1、前面（第4节）平均结果：

| get:set比例   | 0：10 | 5：5 | 10：0 |
| :------------ | ----- | ---- | ----- |
| get_misses    | 0     | 0    | 1045k |
| TPS(次/s)     | 106K  | 107K | 189K  |
| Net_rate(M/s) | 113   | 117  | 189   |

2、部署

源码、运行脚本等文件在/memcached文件夹下。

3、尝试以下参数（内核、网络相关）进行调优

```
object : 
  -
    name : "kernel.numa_balancing"
    info :
        desc : "Specifies whether to enable NUMA automatic balancing."
        get : "sysctl -n kernel.numa_balancing"
        set : "sysctl -w kernel.numa_balancing=$value"
        needrestart : "false"
        type : "discrete"
        options :
          - "0"
          - "1"
        dtype : "string"
  -
    name : "kernel.sched_autogroup_enabled"
    info :
        desc : "When enabled, the kernel creates task groups to optimize desktop program scheduling.
0: disabled
1: enabled"
        get : "sysctl -n kernel.sched_autogroup_enabled"
        set : "sysctl -w kernel.sched_autogroup_enabled=$value"
        needrestart : "false"
        type : "discrete"
        options :
          - "0"
          - "1"
        dtype : "string"
  -
    name : "kernel.sched_wakeup_granularity_ns"
    info :
        desc : "This variable indicates the base of the minimum time that a process should run after it is woken up. The smaller the base, the higher the probability of preemption."
        get : "sysctl -n kernel.sched_wakeup_granularity_ns"
        set : "sysctl -w kernel.sched_wakeup_granularity_ns=$value"
        needrestart : "false"
        type : "discrete"
        scope :
          - 1000000
          - 100000000
        step : 1000000
        items : 
        dtype : "int"
  -
    name : "kernel.sched_min_granularity_ns"
    info :
        desc : "Minimum running time of a process on the CPU. During this time, the kernel does not proactively select other processes for scheduling (in nanoseconds)."
        get : "sysctl -n kernel.sched_min_granularity_ns"
        set : "sysctl -w kernel.sched_min_granularity_ns=$value"
        needrestart : "false"
        type : "discrete"
        scope :
          - 1000000
          - 100000000
        step : 1000000
        items : 
        dtype : "int"
  -
    name : "net.mtu"
    info :
        desc : "Indicates the maximum transmission unit of the network,"
        get : "ifconfig enp1s0 | grep mtu | awk '{print $4}'"
        set : "ifconfig enp1s0 mtu $value"
        needrestart : "false"
        type : "discrete"
        scope :
          - 500
          - 9000
        step : 500
        items : 
        dtype : "int"
  -
    name : "net.generic-receive-offload"
    info :
        desc : "Whether reassembling small packets into larger ones"
        get : ethtool -k enp1s0 | grep "generic-receive-offload" | awk '{print $2}'
        set : "ethtool -K enp1s0 gro $value"
        needrestart : "false"
        type : "discrete"
        options :
          - "on"
          - "off"
        dtype : "string"
  -
    name : "net.generic-segmentation-offload"
    info :
        desc : "Whether reassembling small packets into larger ones"
        get : ethtool -k enp1s0 | grep "generic-segmentation-offload" | awk '{print $2}'
        set : "ethtool -K enp1s0 gso $value"
        needrestart : "false"
        type : "discrete"
        options :
          - "on"
          - "off"
        dtype : "string"
  -
    name : "net.tcp-segmentation-offload"
    info :
        desc : "Wheth allow a device to segment a single frame into multiple frames with a data payload size specified in skb_shinfo()->gso_size."
        get : ethtool -k enp1s0 | grep "tcp-segmentation-offload" | awk '{print $2}'
        set : "ethtool -K enp1s0 tso $value"
        needrestart : "false"
        type : "discrete"
        options :
          - "on"
          - "off"
        dtype : "string"
```

4、部署、训练50轮，得到调优结果如下图：

![输入图片说明](https://images.gitee.com/uploads/images/2021/0811/213952_1b363c5a_5224942.png "image-20210811212251016.png")

## 结果：

目前只对get:set比例5：5的情况下进行调优，得到结果如下

|           | 调优前 | 调优后 | 提升  |
| :-------- | ------ | ------ | ----- |
| TPS(次/s) | 107K   | 110.8K | 3.34% |

后续将继续加入其他参数、memcached参数；并尝试其余get:set比例的情况。